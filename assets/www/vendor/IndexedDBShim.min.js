/*!
 * IndexedDB Polyfill
 *  - original by axemclion (https://github.com/axemclion/IndexedDBShim/)
 */var idbModules={};(function(e){function t(e,t,n,r){n.target=t,typeof t[e]=="function"&&t[e].apply(t,[n]),typeof r=="function"&&r()}function n(e,t,n){!1;var r=new DOMException.constructor(0,t);throw r.name=e,r.message=t,r}var r=function(){this.length=0,this._items=[]};r.prototype={contains:function(e){return-1!==this._items.indexOf(e)},item:function(e){return this._items[e]},indexOf:function(e){return this._items.indexOf(e)},push:function(e){this._items.push(e),this.length+=1},splice:function(){this._items.splice.apply(this._items,arguments),this.length=this._items.length}},e.util={throwDOMException:n,callback:t,quote:function(e){return"'"+e+"'"},StringList:r}})(idbModules),function(e){var t=function(){return{encode:function(e){return JSON.stringify(e)},decode:function(e){return JSON.parse(e)}}}();e.Sca=t}(idbModules),function(e){var t=["","number","string","boolean","object","undefined"],n=function(){return{encode:function(e){return t.indexOf(typeof e)+"-"+JSON.stringify(e)},decode:function(e){return typeof e=="undefined"?undefined:JSON.parse(e.substring(2))}}},r={number:n("number"),"boolean":n(),object:n(),string:{encode:function(e){return t.indexOf("string")+"-"+e},decode:function(e){return""+e.substring(2)}},"undefined":{encode:function(e){return t.indexOf("undefined")+"-undefined"},decode:function(e){return undefined}}},i=function(){return{encode:function(e){return r[typeof e].encode(e)},decode:function(e){return r[t[e.substring(0,1)]].decode(e)}}}();e.Key=i}(idbModules),function(e,t){var n=function(e,t){return{type:e,debug:t,bubbles:!1,cancelable:!1,eventPhase:0,timeStamp:new Date}};e.Event=n}(idbModules),function(e){var t=function(){this.onsuccess=this.onerror=this.result=this.error=this.source=this.transaction=null,this.readyState="pending"},n=function(){this.onblocked=this.onupgradeneeded=null};n.prototype=t,e.IDBRequest=t,e.IDBOpenRequest=n}(idbModules),function(e,t){var n=function(e,t,n,r){this.lower=e,this.upper=t,this.lowerOpen=n,this.upperOpen=r};n.only=function(e){return new n(e,e,!0,!0)},n.lowerBound=function(e,r){return new n(e,t,r,t)},n.upperBound=function(e){return new n(t,e,t,open)},n.bound=function(e,t,r,i){return new n(e,t,r,i)},window.IDBKeyRange=e.IDBKeyRange=n}(idbModules),function(e,t){function n(n,r,i,s,o,u){this.__range=n,this.source=this.__idbObjectStore=i,this.__req=s,this.key=t,this.direction=r,this.__keyColumnName=o,this.__valueColumnName=u,this.source.transaction.__active||e.util.throwDOMException("TransactionInactiveError - The transaction this IDBObjectStore belongs to is not active."),this.__offset=-1,this["continue"]()}n.prototype.__find=function(n,r,i,s){var o=this,u=["SELECT * FROM ",e.util.quote(o.__idbObjectStore.name)],a=[];u.push("WHERE ",o.__keyColumnName," NOT NULL"),o.__range&&(o.__range.lower||o.__range.upper)&&(u.push("AND"),o.__range.lower&&(u.push(o.__keyColumnName+(o.__range.lowerOpen?" >=":" >")+" ?"),a.push(e.Key.encode(o.__range.lower))),o.__range.lower&&o.__range.upper&&u.push("AND"),o.__range.upper&&(u.push(o.__keyColumnName+(o.__range.upperOpen?" < ":" <= ")+" ?"),a.push(e.Key.encode(o.__range.upper)))),u.push(" ORDER BY ",o.__keyColumnName),typeof n!="undefined"?(u.push(o.__range&&(o.__range.lower||o.__range.upper)?"AND":"WHERE"),u.push("key = ?"),a.push(e.Key.encode(n)),u.push("LIMIT 1")):u.push("LIMIT 1 OFFSET "+o.__offset),!1,r.executeSql(u.join(" "),a,function(n,r){if(r.rows.length===1){var s=e.Key.decode(r.rows.item(0)[o.__keyColumnName]),u=o.__valueColumnName==="value"?e.Sca.decode(r.rows.item(0)[o.__valueColumnName]):e.Key.decode(r.rows.item(0)[o.__valueColumnName]);i(s,u)}else!1,i(t,t)},function(e,t){!1,s(t)})},n.prototype["continue"]=function(e){var n=this;this.__idbObjectStore.transaction.__addToTransactionQueue(function(r,i,s,o){n.__offset++,n.__find(e,r,function(e,r){n.key=e,n.value=r,s(typeof n.key!="undefined"?n:t,n.__req)},function(e){o(e)})})},n.prototype.advance=function(n){n<=0&&e.util.throwDOMException("Type Error - Count is invalid - 0 or negative",n);var r=this;this.__idbObjectStore.transaction.__addToTransactionQueue(function(e,i,s,o){r.__offset+=n,r.__find(t,e,function(e,t){r.__offset++,r.key=e,r.value=t,s(r,r.__req)},function(e){o(e)})})},n.prototype.update=function(n){var r=this;return this.__idbObjectStore.transaction.__addToTransactionQueue(function(i,s,o,u){r.__find(t,i,function(t,s){var a="UPDATE "+e.util.quote(r.__idbObjectStore.name)+" SET value = ? WHERE key = ?";!1,i.executeSql(a,[e.Sca.encode(n),e.Key.encode(t)],function(e,n){n.rowsAffected===1?o(t):u("No rowns with key found"+t)},function(e,t){u(t)})},function(e){u(e)})})},n.prototype["delete"]=function(){var n=this;return this.__idbObjectStore.transaction.__addToTransactionQueue(function(r,i,s,o){n.__find(t,r,function(i,u){var a="DELETE FROM  "+e.util.quote(n.__idbObjectStore.name)+" WHERE key = ?";!1,r.executeSql(a,[e.Key.encode(i)],function(e,n){n.rowsAffected===1?s(t):o("No rowns with key found"+i)},function(e,t){o(t)})},function(e){o(e)})})},e.IDBCursor=n}(idbModules),function(e,t){function n(e,t){this.indexName=e,this.__idbObjectStore=this.source=t}n.prototype.__createIndex=function(t,n,r){var i=this,s=i.__idbObjectStore.transaction;s.__addToTransactionQueue(function(o,u,a,f){i.__idbObjectStore.__getStoreProps(o,function(){function u(){e.util.throwDOMException(0,"Could not create new index",arguments)}s.mode!==2&&e.util.throwDOMException(0,"Invalid State error, not a version transaction",i.transaction);var f=JSON.parse(i.__idbObjectStore.__storeProps.indexList);typeof f[t]!="undefined"&&e.util.throwDOMException(0,"Index already exists on store",f);var l=t;f[t]={columnName:l,keyPath:n,optionalParams:r},i.__idbObjectStore.__storeProps.indexList=JSON.stringify(f);var c=["ALTER TABLE",e.util.quote(i.__idbObjectStore.name),"ADD",l,"BLOB"].join(" ");!1,o.executeSql(c,[],function(t,r){t.executeSql("SELECT * FROM "+e.util.quote(i.__idbObjectStore.name),[],function(t,r){(function s(o){if(o<r.rows.length)try{var f=e.Sca.decode(r.rows.item(o).value),c=f[n];t.executeSql("UPDATE "+e.util.quote(i.__idbObjectStore.name)+" set "+l+" = ? where key = ?",[e.Key.encode(c),r.rows.item(o).key],function(e,t){s(o+1)},u)}catch(h){s(o+1)}else!1,t.executeSql("UPDATE __sys__ set indexList = ? where name = ?",[i.__idbObjectStore.__storeProps.indexList,i.__idbObjectStore.name],function(){i.__idbObjectStore.__setReadyState("createIndex",!0),a(i)},u)})(0)},u)},u)},"createObjectStore")})},n.prototype.openCursor=function(t,n){var r=new e.IDBRequest,i=new e.IDBCursor(t,n,this.source,r,this.indexName,"value");return r},n.prototype.openKeyCursor=function(t,n){var r=new e.IDBRequest,i=new e.IDBCursor(t,n,this.source,r,this.indexName,"key");return r},n.prototype.__fetchIndexData=function(n,r){var i=this;return i.__idbObjectStore.transaction.__addToTransactionQueue(function(s,o,u,a){var f=["SELECT * FROM ",e.util.quote(i.__idbObjectStore.name)," WHERE",i.indexName,"NOT NULL"],l=[];typeof n!="undefined"&&(f.push("AND",i.indexName," = ?"),l.push(e.Key.encode(n))),!1,s.executeSql(f.join(" "),l,function(n,i){var s;typeof r=="count"?s=i.rows.length:i.rows.length===0?s=t:r==="key"?s=e.Key.decode(i.rows.item(0).key):s=e.Sca.decode(i.rows.item(0).value),u(s)},a)})},n.prototype.get=function(e){return this.__fetchIndexData(e,"value")},n.prototype.getKey=function(e){return this.__fetchIndexData(e,"key")},n.prototype.count=function(e){return this.__fetchIndexData(e,"count")},e.IDBIndex=n}(idbModules),function(e){var t=function(t,n,r){this.name=t,this.transaction=n,this.__ready={},this.__setReadyState("createObjectStore",typeof r=="undefined"?!0:r),this.indexNames=new e.util.StringList};t.prototype.__setReadyState=function(e,t){this.__ready[e]=t},t.prototype.__waitForReady=function(e,t){var n=!0;if(typeof t!="undefined")n=typeof this.__ready[t]=="undefined"?!0:this.__ready[t];else for(var r in this.__ready)this.__ready[r]||(n=!1);if(n)e();else{!1;var i=this;window.setTimeout(function(){i.__waitForReady(e,t)},100)}},t.prototype.__getStoreProps=function(e,t,n){var r=this;this.__waitForReady(function(){r.__storeProps?t(r.__storeProps):e.executeSql("SELECT * FROM __sys__ where name = ?",[r.name],function(e,n){n.rows.length!==1?t():(r.__storeProps={name:n.rows.item(0).name,indexList:n.rows.item(0).indexList,autoInc:n.rows.item(0).autoInc,keyPath:n.rows.item(0).keyPath},t(r.__storeProps))},function(){t()})},n)},t.prototype.__deriveKey=function(t,n,r,i){function s(){t.executeSql("SELECT * FROM sqlite_sequence where name like ?",[o.name],function(e,t){t.rows.length!==1?i(0):i(t.rows.item(0).seq)},function(t,n){e.util.throwDOMException(0,"Data Error - Could not get the auto increment value for key",n)})}var o=this;o.__getStoreProps(t,function(t){t||e.util.throwDOMException(0,"Data Error - Could not locate defination for this table",t);if(t.keyPath){typeof r!="undefined"&&e.util.throwDOMException(0,"Data Error - The object store uses in-line keys and the key parameter was provided",t);if(n)try{var o=n[t.keyPath];o?i(o):t.autoInc==="true"?s():e.util.throwDOMException(0,"Data Error - Could not eval key from keyPath")}catch(u){e.util.throwDOMException(0,"Data Error - Could not eval key from keyPath",u)}else e.util.throwDOMException(0,"Data Error - KeyPath was specified, but value was not")}else typeof r!="undefined"?i(r):t.autoInc==="false"?e.util.throwDOMException(0,"Data Error - The object store uses out-of-line keys and has no key generator and the key parameter was not provided. ",t):s()})},t.prototype.__insertData=function(t,n,r,i,s){var o={};typeof r!="undefined"&&(o.key=e.Key.encode(r));var u=JSON.parse(this.__storeProps.indexList);for(var a in u)try{o[u[a].columnName]=e.Key.encode(n[u[a].keyPath])}catch(f){s(f)}var l=["INSERT INTO ",e.util.quote(this.name),"("],c=[" VALUES ("],h=[];for(a in o)l.push(a+","),c.push("?,"),h.push(o[a]);l.push("value )"),c.push("?)"),h.push(e.Sca.encode(n));var p=l.join(" ")+c.join(" ");!1,t.executeSql(p,h,function(e,t){i(r)},function(e,t){s(t)})},t.prototype.add=function(e,t){var n=this;return n.transaction.__addToTransactionQueue(function(r,i,s,o){n.__deriveKey(r,e,t,function(t){n.__insertData(r,e,t,s,o)})})},t.prototype.put=function(t,n){var r=this;return r.transaction.__addToTransactionQueue(function(i,s,o,u){r.__deriveKey(i,t,n,function(n){var s="DELETE FROM "+e.util.quote(r.name)+" where key = ?";i.executeSql(s,[e.Key.encode(n)],function(e,i){!1,r.__insertData(e,t,n,o,u)},function(e,t){u(t)})})})},t.prototype.get=function(t){var n=this;return n.transaction.__addToTransactionQueue(function(r,i,s,o){n.__waitForReady(function(){var i=e.Key.encode(t);!1,r.executeSql("SELECT * FROM "+e.util.quote(n.name)+" where key = ?",[i],function(t,n){!1;try{if(0===n.rows.length)return s();s(e.Sca.decode(n.rows.item(0).value))}catch(r){!1,s(undefined)}},function(e,t){o(t)})})})},t.prototype["delete"]=function(t){var n=this;return n.transaction.__addToTransactionQueue(function(r,i,s,o){n.__waitForReady(function(){var i=e.Key.encode(t);!1,r.executeSql("DELETE FROM "+e.util.quote(n.name)+" where key = ?",[i],function(e,t){!1,s()},function(e,t){o(t)})})})},t.prototype.clear=function(){var t=this;return t.transaction.__addToTransactionQueue(function(n,r,i,s){t.__waitForReady(function(){var r=e.Key.encode(undefined);!1,n.executeSql("DELETE FROM "+e.util.quote(t.name),[],function(e,t){!1,i()},function(e,t){s(t)})})})},t.prototype.count=function(t){var n=this;return n.transaction.__addToTransactionQueue(function(r,i,s,o){n.__waitForReady(function(){var i="SELECT * FROM "+e.util.quote(n.name)+(typeof t!="undefined"?" WHERE key = ?":""),u=[];typeof t!="undefined"&&u.push(e.Key.encode(t)),r.executeSql(i,u,function(e,t){s(t.rows.length)},function(e,t){o(t)})})})},t.prototype.openCursor=function(t,n){var r=new e.IDBRequest,i=new e.IDBCursor(t,n,this,r,"key","value");return r},t.prototype.index=function(t){var n=new e.IDBIndex(t,this);return n},t.prototype.createIndex=function(t,n,r){var i=this;r=r||{},i.__setReadyState("createIndex",!1);var s=new e.IDBIndex(t,i);return i.__waitForReady(function(){s.__createIndex(t,n,r)},"createObjectStore"),i.indexNames.push(t),s},t.prototype.deleteIndex=function(t){var n=new e.IDBIndex(t,this,!1);return n.__deleteIndex(t),n},e.IDBObjectStore=t}(idbModules),function(e){var t=0,n=1,r=2,i=function(r,i,s){typeof i=="number"?(this.mode=i,!1):typeof i=="string"&&(this.mod="readwrite"===i?n:t),this.storeNames=typeof r=="string"?[r]:r;for(var o=0;o<this.storeNames.length;o++)s.objectStoreNames.contains(this.storeNames[o])||e.util.throwDOMException(0,"The operation failed because the requested database object could not be found. For example, an object store did not exist but was being opened.",this.storeNames[o]);this.__active=!0,this.__running=!1,this.__requests=[],this.__aborted=!1,this.db=s,this.error=null,this.onabort=this.onerror=this.oncomplete=null;var u=this};i.prototype.__executeRequests=function(){if(this.__running&&this.mode!==r){!1;return}this.__running=!0;var t=this;window.setTimeout(function(){t.mode!==2&&!t.__active&&e.util.throwDOMException(0,"A request was placed against a transaction which is currently not active, or which is finished",t.__active),t.db.__db.transaction(function(n){function s(t,n){n&&(r.req=n),r.req.readyState="done",r.req.result=t,delete r.req.error;var s=e.Event("success");e.util.callback("onsuccess",r.req,s),i++,u()}function o(t){r.req.readyState="done",r.req.error="DOMError";var n=e.Event("error",arguments);e.util.callback("onerror",r.req,n),i++,u()}t.__tx=n;var r=null,i=0;try{function u(){if(i>=t.__requests.length){t.__active=!1,t.__requests=[];return}r=t.__requests[i],r.op(n,r.args,s,o)}u()}catch(a){!1,typeof t.onerror=="function"&&t.onerror()}},function(){!1,typeof t.onerror=="function"&&t.onerror()},function(){!1,typeof t.oncomplete=="function"&&t.oncomplete()})},1)},i.prototype.__addToTransactionQueue=function(t,n){!this.__active&&this.mode!==r&&e.util.throwDOMException(0,"A request was placed against a transaction which is currently not active, or which is finished.",this.__mode);var i=new e.IDBRequest;return i.source=this.db,this.__requests.push({op:t,args:n,req:i}),this.__executeRequests(),i},i.prototype.objectStore=function(t){return new e.IDBObjectStore(t,this)},i.prototype.abort=function(){!this.__active&&e.util.throwDOMException(0,"A request was placed against a transaction which is currently not active, or which is finished",this.__active)},i.prototype.READ_ONLY=0,i.prototype.READ_WRITE=1,i.prototype.VERSION_CHANGE=2,e.IDBTransaction=i}(idbModules),function(e){var t=function(t,n,r,i){this.__db=t,this.version=r,this.__storeProperties=i,this.objectStoreNames=new e.util.StringList;for(var s=0;s<i.rows.length;s++)this.objectStoreNames.push(i.rows.item(s).name);this.name=n,this.onabort=this.onerror=this.onversionchange=null};t.prototype.createObjectStore=function(t,n){var r=this;n=n||{},n.keyPath=n.keyPath||null;var i=new e.IDBObjectStore(t,r.__versionTransaction,!1),s=r.__versionTransaction;return s.__addToTransactionQueue(function(s,o,u,a){function f(){e.util.throwDOMException(0,"Could not create new object store",arguments)}r.__versionTransaction||e.util.throwDOMException(0,"Invalid State error",r.transaction);var l=["CREATE TABLE",e.util.quote(t),"(key BLOB",n.autoIncrement?", inc INTEGER PRIMARY KEY AUTOINCREMENT":"PRIMARY KEY",", value BLOB)"].join(" ");!1,s.executeSql(l,[],function(e,r){e.executeSql("INSERT INTO __sys__ VALUES (?,?,?,?)",[t,n.keyPath,n.autoIncrement?!0:!1,"{}"],function(){i.__setReadyState("createObjectStore",!0),u(i)},f)},f)}),r.objectStoreNames.push(t),i},t.prototype.deleteObjectStore=function(t){var n=function(){e.util.throwDOMException(0,"Could not delete ObjectStore",arguments)},r=this;!r.objectStoreNames.contains(t)&&n("Object Store does not exist"),r.objectStoreNames.splice(r.objectStoreNames.indexOf(t),1);var i=r.__versionTransaction;i.__addToTransactionQueue(function(i,s,o,u){r.__versionTransaction||e.util.throwDOMException(0,"Invalid State error",r.transaction),r.__db.transaction(function(r){r.executeSql("SELECT * FROM __sys__ where name = ?",[t],function(r,i){i.rows.length>0&&r.executeSql("DROP TABLE "+e.util.quote(t),[],function(){r.executeSql("DELETE FROM __sys__ WHERE name = ?",[t],function(){},n)},n)})})})},t.prototype.close=function(){},t.prototype.transaction=function(t,n){var r=new e.IDBTransaction(t,n||1,this);return r},e.IDBDatabase=t}(idbModules),function(e){var t=4194304,n=window.openDatabase("__sysdb__",1,"System Database",t);n.transaction(function(t){t.executeSql("SELECT * FROM dbVersions",[],function(e,t){},function(){n.transaction(function(t){t.executeSql("CREATE TABLE IF NOT EXISTS dbVersions (name VARCHAR(255), version INT);",[],function(){},function(){e.util.throwDOMException("Could not create table __sysdb__ to save DB versions")})})})},function(){e.util.throwDOMException("Could not create table __sysdb__ to save DB versions")});var r={open:function(r,i){function u(){if(o)return;var t=e.Event("error",arguments);s.readyState="done",s.error="DOMError",e.util.callback("onerror",s,t),o=!0}function a(o){var a=window.openDatabase(r,1,r,t);s.readyState="done",typeof i=="undefined"&&(i=o||1),(i<=0||o>i)&&e.util.throwDOMException(0,"An attempt was made to open a database using a lower version than the existing version.",i),a.transaction(function(t){t.executeSql("CREATE TABLE IF NOT EXISTS __sys__ (name VARCHAR(255), keyPath VARCHAR(255), autoInc BOOLEAN, indexList BLOB)",[],function(){t.executeSql("SELECT * FROM __sys__",[],function(t,f){var l=e.Event("success");s.source=s.result=new e.IDBDatabase(a,r,i,f),o<i?n.transaction(function(t){t.executeSql("UPDATE dbVersions set version = ? where name = ?",[i,r],function(){var t=e.Event("upgradeneeded");t.oldVersion=o,t.newVersion=i,s.transaction=s.result.__versionTransaction=new e.IDBTransaction([],2,s.source),e.util.callback("onupgradeneeded",s,t,function(){var t=e.Event("success");e.util.callback("onsuccess",s,t)})},u)},u):e.util.callback("onsuccess",s,l)},u)},u)},u)}var s=new e.IDBOpenRequest,o=!1;return n.transaction(function(e){e.executeSql("SELECT * FROM dbVersions where name = ?",[r],function(e,t){t.rows.length===0?e.executeSql("INSERT INTO dbVersions VALUES (?,?)",[r,i||1],function(){a(0)},u):a(t.rows.item(0).version)},u)},u),s},deleteDatabase:function(r){function o(t){if(s)return;i.readyState="done",i.error="DOMError";var n=e.Event("error");n.message=t,n.debug=arguments,e.util.callback("onerror",i,n),s=!0}function a(){n.transaction(function(t){t.executeSql("DELETE FROM dbVersions where name = ? ",[r],function(){i.result=undefined;var t=e.Event("success");t.newVersion=null,t.oldVersion=u,e.util.callback("onsuccess",i,t)},o)},o)}var i=new e.IDBOpenRequest,s=!1,u=null;return n.transaction(function(e){e.executeSql("SELECT * FROM dbVersions where name = ?",[r],function(e,n){if(n.rows.length===0){o("Database does not exist");return}var i=n.rows.item(0).version,s=window.openDatabase(r,1,r,t);s.transaction(function(e){e.executeSql("SELECT * FROM __sys__",[],function(e,t){var n=t.rows;(function r(t){t>=n.length?e.executeSql("DROP TABLE __sys__",[],function(){a()},o):e.executeSql("DROP TABLE "+n.item(t).name,[],function(){r(t+1)},function(){r(t+1)})})(0)},function(e){a()})},o)})},o),i},cmp:function(t,n){return e.Key.encode(t)>e.Key.encode(n)?1:t===n?0:-1}};e.shimIndexedDB=r}(idbModules),function(e,t){e.shimIndexedDB=t.shimIndexedDB,e.shimIndexedDB.__useShim=function(){e.indexedDB=t.shimIndexedDB,e.IDBDatabase=t.IDBDatabase,e.IDBTransaction=t.IDBTransaction,e.IDBCursor=t.IDBCursor,e.IDBKeyRange=t.IDBKeyRange},e.indexedDB=e.indexedDB||e.webkitIndexedDB||e.mozIndexedDB||e.oIndexedDB||e.msIndexedDB,typeof e.indexedDB=="undefined"?e.shimIndexedDB.__useShim():(e.IDBDatabase=e.IDBDatabase||e.webkitIDBDatabase,e.IDBTransaction=e.IDBTransaction||e.webkitIDBTransaction,e.IDBCursor=e.IDBCursor||e.webkitIDBCursor,e.IDBKeyRange=e.IDBKeyRange||e.webkitIDBKeyRange)}(window,idbModules);